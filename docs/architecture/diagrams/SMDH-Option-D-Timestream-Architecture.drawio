<mxfile host="app.diagrams.net" modified="2025-01-28T00:00:00.000Z" agent="Claude Code" version="24.0.0">
  <diagram name="Option D: Timestream + Grafana Architecture" id="option-d-timestream">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="SMDH Option D: Pure AWS-Native Architecture (Timestream + Grafana)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="900" height="40" as="geometry" />
        </mxCell>

        <!-- Cost Badge -->
        <mxCell id="cost-badge" value="Monthly Cost: $3,965 (30 tenants)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="20" width="260" height="40" as="geometry" />
        </mxCell>

        <!-- AWS Native Badge -->
        <mxCell id="aws-badge" value="âœ… Fully AWS-Native" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#2196f3;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1290" y="20" width="260" height="40" as="geometry" />
        </mxCell>

        <!-- Layer 1: Data Sources -->
        <mxCell id="layer-sources" value="DATA SOURCES (All Types Unified)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5fe;strokeColor=#01579b;verticalAlign=top;fontStyle=1;fontSize=14;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="1500" height="100" as="geometry" />
        </mxCell>

        <mxCell id="source-machines" value="Machine Sensors&#xa;(1Hz MQTT)&#xa;Continuous data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="160" height="50" as="geometry" />
        </mxCell>

        <mxCell id="source-energy" value="Energy Monitors&#xa;(15s Modbus/MQTT)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="290" y="120" width="160" height="50" as="geometry" />
        </mxCell>

        <mxCell id="source-air" value="Air Quality Sensors&#xa;(1min MQTT)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="120" width="160" height="50" as="geometry" />
        </mxCell>

        <mxCell id="source-rfid" value="RFID/Barcode&#xa;(Event-driven REST)&#xa;Discrete events" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="670" y="120" width="160" height="50" as="geometry" />
        </mxCell>

        <mxCell id="volume-label" value="Combined volume: 2.6M-3.9M rows/day â†’ Single Timestream DB" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="900" y="130" width="400" height="30" as="geometry" />
        </mxCell>

        <!-- Layer 2: Ingestion -->
        <mxCell id="layer-ingestion" value="INGESTION &amp; ROUTING LAYER" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;verticalAlign=top;fontStyle=1;fontSize=14;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="200" width="1500" height="120" as="geometry" />
        </mxCell>

        <mxCell id="iot-core" value="AWS IoT Core&#xa;MQTT Broker&#xa;X.509 Auth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="240" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="iot-rules" value="IoT Rules Engine&#xa;Route all data types&#xa;Tenant enrichment" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="270" y="240" width="150" height="60" as="geometry" />
        </mxCell>

        <mxCell id="kinesis-streams" value="Kinesis Streams&#xa;Buffering&#xa;Partition: tenant_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="240" width="150" height="60" as="geometry" />
        </mxCell>

        <mxCell id="lambda-ingest" value="Lambda&#xa;Ingestion Handler&#xa;Validation/Enrich" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="630" y="240" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="lambda-alert" value="Lambda (Fast-Path)&#xa;Alert Checks&#xa;&lt;5s latency" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcdd2;strokeColor=#e53935;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="240" width="150" height="60" as="geometry" />
        </mxCell>

        <!-- Layer 3: Data Platform (Timestream) -->
        <mxCell id="layer-timestream" value="DATA PLATFORM - AMAZON TIMESTREAM (Unified Storage)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8daef;strokeColor=#8e44ad;verticalAlign=top;fontStyle=1;fontSize=14;strokeWidth=3;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="340" width="1500" height="160" as="geometry" />
        </mxCell>

        <mxCell id="timestream-write" value="Timestream&#xa;Write API&#xa;High throughput" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5c6e0;strokeColor=#8e44ad;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="390" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="timestream-tables" value="Timestream Tables&#xa;â€¢ machine_metrics&#xa;â€¢ energy_data&#xa;â€¢ air_quality&#xa;â€¢ rfid_events&#xa;Partition: tenant_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5c6e0;strokeColor=#8e44ad;fontSize=10;align=left;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="270" y="380" width="180" height="90" as="geometry" />
        </mxCell>

        <mxCell id="timestream-memory" value="Memory Store&#xa;Hot data (24h)&#xa;Fast queries" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5c6e0;strokeColor=#8e44ad;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="390" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="timestream-magnetic" value="Magnetic Store&#xa;Warm data (90d)&#xa;Cost-optimized" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8daef;strokeColor=#8e44ad;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="650" y="390" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="timestream-query" value="Timestream Query&#xa;SQL analytics&#xa;Multi-tenant RLS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5c6e0;strokeColor=#8e44ad;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="390" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="s3-archive" value="S3 Archive&#xa;Cold storage (2y)&#xa;$0.023/GB/month" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="990" y="390" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Layer 4: Application State -->
        <mxCell id="layer-application" value="APPLICATION STATE &amp; CONFIGURATION" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3cd;strokeColor=#ffc107;verticalAlign=top;fontStyle=1;fontSize=14;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="520" width="1500" height="100" as="geometry" />
        </mxCell>

        <mxCell id="dynamodb" value="DynamoDB&#xa;â€¢ Tenant config&#xa;â€¢ Device registry&#xa;â€¢ User preferences&#xa;â€¢ Dashboard configs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff9c4;strokeColor=#fbc02d;fontSize=10;align=left;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="560" width="180" height="50" as="geometry" />
        </mxCell>

        <mxCell id="api-gateway" value="API Gateway&#xa;REST APIs&#xa;Multi-tenant auth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c5e1a5;strokeColor=#558b2f;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="310" y="560" width="140" height="50" as="geometry" />
        </mxCell>

        <mxCell id="lambda-api" value="Lambda&#xa;API handlers&#xa;Business logic" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="560" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="cognito" value="Cognito&#xa;User Pools&#xa;SSO/MFA" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffccbc;strokeColor=#bf360c;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="640" y="560" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="secrets" value="Secrets Manager&#xa;API keys&#xa;Credentials" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#880e4f;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="790" y="560" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Layer 5: Frontend & Analytics -->
        <mxCell id="layer-frontend" value="FRONTEND &amp; ANALYTICS LAYER" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f1f8e9;strokeColor=#558b2f;verticalAlign=top;fontStyle=1;fontSize=14;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="640" width="1500" height="180" as="geometry" />
        </mxCell>

        <mxCell id="grafana" value="Grafana Cloud&#xa;White-label dashboards&#xa;Timestream plugin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b2dfdb;strokeColor=#00695c;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="690" width="170" height="60" as="geometry" />
        </mxCell>

        <mxCell id="grafana-features" value="Grafana Features:&#xa;â€¢ Full white-labeling&#xa;â€¢ Embeddable dashboards&#xa;â€¢ Native Timestream plugin&#xa;â€¢ Custom variables&#xa;â€¢ Alert management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#00695c;fontSize=10;align=left;" vertex="1" parent="1">
          <mxGeometry x="100" y="760" width="170" height="50" as="geometry" />
        </mxCell>

        <mxCell id="react-app" value="React Frontend&#xa;Tenant portal&#xa;Admin console" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c5e1a5;strokeColor=#558b2f;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="300" y="690" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="amplify" value="AWS Amplify&#xa;Hosting&#xa;CI/CD" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b2dfdb;strokeColor=#00695c;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="470" y="690" width="130" height="60" as="geometry" />
        </mxCell>

        <mxCell id="cloudwatch" value="CloudWatch&#xa;Alarms&#xa;Auto-scaling" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d1c4e9;strokeColor=#512da8;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="630" y="690" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="sns" value="SNS/SES&#xa;Notifications&#xa;Email/SMS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8bbd0;strokeColor=#880e4f;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="780" y="690" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="sagemaker" value="SageMaker&#xa;Custom ML&#xa;Predictions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ce93d8;strokeColor=#6a1b9a;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="930" y="690" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Key Characteristics Box -->
        <mxCell id="characteristics" value="KEY CHARACTERISTICS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#2196f3;verticalAlign=top;fontStyle=1;fontSize=12;align=left;" vertex="1" parent="1">
          <mxGeometry x="1180" y="340" width="350" height="320" as="geometry" />
        </mxCell>

        <mxCell id="char-text" value="âœ… Strengths:&#xa;â€¢ Fully AWS-native (no Snowflake)&#xa;â€¢ Unified storage (time-series + events)&#xa;â€¢ Native partition-based multi-tenancy&#xa;â€¢ Grafana white-label dashboards&#xa;â€¢ Real-time latency (&lt;5s)&#xa;â€¢ Cost-effective ($132/tenant)&#xa;â€¢ Auto-scaling (no tuning)&#xa;â€¢ Simpler than Flink option&#xa;&#xa;âš ï¸ Considerations:&#xa;â€¢ Timestream SQL differs from standard&#xa;â€¢ Grafana adds external dependency&#xa;â€¢ More complex than Snowflake option&#xa;â€¢ Medium operational overhead&#xa;â€¢ 22-week timeline&#xa;&#xa;ðŸ’° Cost: $3,965/month (30 tenants)&#xa;ðŸ‘¥ Team: 2-3 engineers (AWS-native)&#xa;â±ï¸ Timeline: 22 weeks&#xa;ðŸŽ¯ Best for: AWS-native mandate" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1190" y="365" width="330" height="285" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;endArrow=classic;endFill=1;" edge="1" parent="1" source="source-machines" target="iot-core">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;endArrow=classic;endFill=1;" edge="1" parent="1" source="iot-core" target="iot-rules">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#d6b656;endArrow=classic;endFill=1;" edge="1" parent="1" source="iot-rules" target="kinesis-streams">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#d79b00;endArrow=classic;endFill=1;" edge="1" parent="1" source="kinesis-streams" target="lambda-ingest">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#e53935;endArrow=classic;endFill=1;dashed=1;" edge="1" parent="1" source="iot-rules" target="lambda-alert">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="345" y="220" />
              <mxPoint x="875" y="220" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow5-label" value="Fast-path alerts" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=10;fontStyle=1;fontColor=#e53935;" vertex="1" connectable="0" parent="arrow5">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#8e44ad;endArrow=classic;endFill=1;" edge="1" parent="1" source="lambda-ingest" target="timestream-write">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="360" />
              <mxPoint x="170" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#8e44ad;endArrow=classic;endFill=1;" edge="1" parent="1" source="timestream-write" target="timestream-tables">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#8e44ad;endArrow=classic;endFill=1;" edge="1" parent="1" source="timestream-tables" target="timestream-memory">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#8e44ad;endArrow=classic;endFill=1;" edge="1" parent="1" source="timestream-memory" target="timestream-magnetic">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9673a6;endArrow=classic;endFill=1;dashed=1;" edge="1" parent="1" source="timestream-magnetic" target="s3-archive">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow10-label" value="After 90d" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;fontStyle=2;" vertex="1" connectable="0" parent="arrow10">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=3;strokeColor=#00695c;endArrow=classic;endFill=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="timestream-query" target="grafana">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="890" y="660" />
              <mxPoint x="185" y="660" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#558b2f;endArrow=classic;endFill=1;" edge="1" parent="1" source="api-gateway" target="react-app">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="380" y="650" />
              <mxPoint x="370" y="650" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Multi-tenancy highlight -->
        <mxCell id="mt-highlight" value="ðŸŽ¯ Native Multi-Tenancy:&#xa;Partition key = tenant_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="950" y="560" width="190" height="50" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
